// backend/controllers/vulnerabilityController.js

const scannerService = require('../services/scannerService');
const logger = require('../utils/logger');

// Controller to handle retrieving vulnerabilities and scanning
exports.getAllVulnerabilities = async (req, res) => {
  // Return dummy data for now; later integrate real scanning results
  res.json({ vulnerabilities: [] });
};

exports.scan = async (req, res) => {
  try {
    // Execute both npm audit and Retire.js scans in parallel
    const [auditResults, retireResults] = await Promise.all([
      scannerService.scanProject(),
      scannerService.scanRetire()
    ]);
    res.json({
      npmAudit: auditResults,
      retireJS: retireResults
    });
  } catch (error) {
    logger.error(`Scan error: ${error.message}`);
    res.status(500).json({ error: error.message });
  }
};
